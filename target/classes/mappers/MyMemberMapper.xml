<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring5legacy.mypro00.mapper.MyMemberMapper">
  <resultMap type="com.spring5legacy.mypro00.domain.MyAuthorityVO" id="authMap">
    <result property="userid" column="userid"/>
    <result property="authority" column="authority"/>
  </resultMap>

  <resultMap type="com.spring5legacy.mypro00.domain.MyMemberVO" id="memberMap">
    <result property="userid" column="USERID"/>
    <result property="userpw" column="USERPW"/>
    <result property="username" column="USERNAME"/>
    <result property="mregDate" column="MREGDATE"/>
    <result property="mmodDate" column="MMODDATE"/>
    <result property="mdropFlag" column="MDROPFLAG"/>
    <result property="enabled" column="ENABLED"/>
    <collection property="authList" resultMap="authMap"/>
  </resultMap>

  <select id="selectMember" resultMap="memberMap">
    SELECT m.USERID, m.USERPW, m.USERNAME, m.MREGDATE, m.MMODDATE, m.MDROPFLAG, m.ENABLED, a.AUTHORITY
    FROM myuser.tbl_mymember m 
    LEFT OUTER JOIN myuser.tbl_mymember_authorities a ON (m.userid = a.userid)
    WHERE m.userid = #{userid}
  </select>

  <insert id="insertMember">
    INSERT INTO myuser.tbl_mymember (USERID, USERPW, USERNAME, MREGDATE, MMODDATE, MDROPFLAG, ENABLED)
    VALUES (#{userid}, #{userpw}, #{username}, DEFAULT, DEFAULT, DEFAULT, DEFAULT)
  </insert>

  <insert id="insertMemberAuth">
    INSERT INTO myuser.tbl_mymember_authorities (USERID, AUTHORITY)
    VALUES (#{userid}, #{authority})
  </insert>

</mapper>
